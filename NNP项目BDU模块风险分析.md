# NNP项目BDU模块风险分析

## DSP程序运行风险

1. 任务运行时栈溢出（任务栈空间分配不够）
2. 任务运行时间超时（任务时间分配不够）
3. 程序中存在内存越界问题（非法的数组，指针操作）
4. 程序中存在非法操作导致进入非法中断引起看门狗复位（非法指针操作，除零操作等）

程序运行风险主要针对的是BDU程序本身运行时可能出现的问题，这类风险如果真的发生会导致控制程序不能按照预期正确运行乃至彻底不工作，但这类问题一般通过完备的测试都能发现和排除。

应对策略： 

- 软件设计和编码要规范，避免错误。
- 软件的测试要完备，保证软件测试的代码覆盖率。

## 比例阀控制风险

1. 空气源比例阀控制失效
2. 氧气源比例阀控制失效
3. peep阀控制失效
4. 安全阀控制失效

呼吸机中的各种阀是呼吸机控制的直接执行机构，通过控制阀，BDU实现各类控制目标。因此如果各种阀出现问题，呼吸机会失去控制能力。

应对策略：

- 做好报警保护，当阀控制失效时，会体现在流量，压力等监测数据上。
- 对于主要的阀硬件应该支持故障监测和提供故障反馈信号，通过反馈IO直接提示BDU阀出现了故障。

## 数据采集风险

1. 空气，氧气流量传感器数据读取失败或者错误。
2. 近端流量传感器数据读取失败或错误。
3. 近端气道压力数据读取失败或错误。
4. 气源压力传感器数据读取失败或错误。

以上传感器和数据采集模块如果出现损坏，或者传输数据的持续错误，将会导致呼吸机控制出错乃至完全失控，并且针对流量和压力的报警也会失效。

应对策略： 

- 做好数据采集模块的通讯丢失报警和保护。 
- 做好采集数据的验证，如果采集数据超过正常值应作处理和报警。

## 通讯失败风险

1. 与UI通讯失败或错误。
2. 与电源板通讯失败或错误。
3. 与功能安全MCU通讯失败或错误。

BDU接收来自UI的指令，并且与电源板和保护MCU通讯协调工作。如果与UI通讯失败，呼吸机将无法受用户控制，同时无法更新显示状态和参数。

应对策略： 

- 通讯中增加数据验证单元，目前已经采用了checksum验证。
- 通讯中要有数据传输确认机制
- 通讯双方要定时确认与对方通讯正常，如果出现通讯出错，及时报警。

## 用户不当操作带来的风险

1. 意外堵塞或者拔掉呼吸管路
2. 压力采样管被挤压
3. 有不正确的指令或者设置参数输入

呼吸机在使用过程中用户可能会存在各种各样的行为，这些行为会对BDU的控制产生影响导致控制失效或者其他意外情况。

应对策略：

- 产品要定义好用户的输入范围，并在UI层面对用户的所有输入做合理的限制。
- 在BDU程序中对输入项做合理限幅。
- 考虑到用户操作对于呼吸机控制带来的风险，在程序中做好保护和报警。